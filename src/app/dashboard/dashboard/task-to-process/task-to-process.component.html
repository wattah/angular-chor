<div class="block block-shadow" *ngIf="isExistTasks">
  <h2 class="block-title athena">
      Tâches à traiter 
      <a class="block-title-item-link athena" [routerLink]="['/request-monitoring']" queryParamsHandling="merge" *ngxPermissionsOnly="['affichage_demandes']">
          <span class="text-min normal no-transform athena"> Voir toutes les demandes </span>
      </a>
      <span class="block-title-item-link athena" >
          <span class="text-giant normal light-grey no-transform athena"> | </span> 
      </span>
      <a class="block-title-item-link athena" [routerLink]="null" (click)="allTasksClick()" queryParamsHandling="merge" *ngxPermissionsOnly="['affichage_taches']">
          <span class="text-min normal no-transform athena">Voir toutes les tâches </span>
      </a>
  </h2>
  <section class="container-fluid">
      <header class="row">
          <span class="col-md-3 col-lg-1 col-form-label grey"> Tâches </span>
          <select class="form-control athena col-md-6 col-lg-6" id="user" 
          [(ngModel)]="connectedUserId" name="connectedUserId" (change)="changeUser()" >
        <option *ngFor="let user of usersList" [ngValue]="user.id">
            {{ user?.lastName | uppercase}}  {{user?.firstName | firstName}} 
        </option>
    </select>
      </header>
      <app-athena-table-loader *ngIf="incompleteCall"></app-athena-table-loader>
      <app-athena-paginated-ag-grid *ngIf="!incompleteCall"
          [defaultSortModel]="defaultSortModelTasks"
          [paginationPageSize]="10"
          [columnDefs]="columnDefsTasks" 
          [suppressRowClickSelection]="true"
          [loadAgGridParams]="params"
          [rowSelection]="'multiple'"
          (selectRows)="selectRows($event)"
          [frameworkComponents]="frameworkComponents"
          [rowData]="rowDataTasks" (clickedCell)="clickCell($event)"
          [headerHeight]="60"
          (gridReady)="onGridReady($event)"
      >
      </app-athena-paginated-ag-grid>
      <header class="block-title athena position-relative">

        <span>
            <ng-template #popContent1> 
              <div class="row  ">       
                <span class=" athena icon clickable cart-caption ml-1" ></span>
                <span class="title ml-1"> Légende  </span>
                <span  class="icon close clickable position-cross  "> </span>
            </div>
            <table aria-describedby="" class="table table-not-bordered ">
                <th id=""></th>
                <tbody>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-grey-normal"></span></td>
                        <td>Le panier n'utilise pas d'envoi Publidispatch ou l'ordre a été annulée abandonnée ou pas encore créé</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-yellow-normal"></span></td>
                        <td>La commande a été créée et elle n'est pas encore prise en compte par Publidispatch</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon panier-yellow-parnasse"></span></td>
                        <td>La commande a été créée et elle n'est pas encore prise en compte par WinGSM</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-purple-normal"></span></td>
                        <td>La commande a été prise par Publidispatch</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-purple-parnasse"></span></td>
                        <td>La commande a été prise par WinGSM</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-orange-normal"></span></td>
                        <td>La commande a été rejetée, expédiée ou partiellement expédiée mais des numéros de série n'ont pas été saisis ou ne sont pas gérés par Publidispatch</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-orange-parnasse"></span></td>
                        <td>La commande a été rejetée, expédiée partiellement ou expédiée mais des numéros de série n'ont pas été saisis par WinGSM</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-green-normal"></span></td>
                        <td>La commande est en cours de livraison ou a été expédiée avec tous les numéros de série saisis</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-green-parnasse"></span></td>
                        <td>La commande utilise le stock Parnasse et le matériel a été mis à disposition par la logistique</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-blue-normal"></span></td>
                        <td>La commande a été livrée au client</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-blue-parnasse"></span></td>
                        <td>La commande utilise le stock Parnasse et elle a été livrée</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-red-normal"></span></td>
                        <td>La commande a été retournée par le livreur</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-red-parnasse"></span></td>
                        <td>La commande a été retournée par le livreur pour un stock différent de Publidispatch</td>
                    </tr>
                    <tr>
                        <td class="table-td-icon"><span class="icon cart-grey-error"></span></td>
                        <td>La commande est une erreur ou a été envoyée à Publidispatch il y a plus de 24h avec aucun retour de leur part</td>
                    </tr>
            <tr>
                <td class="table-td-icon"><span class="icon cadenas-rouge"></span></td>
                <td>Panier contenant au moins un article bloqué</td>
            </tr>
        </tbody>
    </table>
             </ng-template>
              <span class="icon clickable cart-caption cursour "placement="right"
                [ngbPopover]="popContent1" popoverClass="my-cart-popup-class" >
              </span>
    </span>

        <button *ngIf="isVisibleBtnBlocking" type="submit"  class="btn btn-green btn-debloque" (click)="getSelectedRowDataforUnblock()">Débloquer la sélection</button> 

          <a class="block-title-item-link athena" [routerLink]="null" (click)="myTasksClick()" queryParamsHandling="merge" *ngxPermissionsOnly="['afficher_taches_autres']">
              Voir toutes les tâches à traiter
              <span class="icon icon-min arrow-right-blue athena"></span
          ></a>
      </header>
  </section> 
</div>

<div class="block block-shadow" *ngIf="!isExistTasks">
    <h2 class="block-title athena">
        Pas de tâches à traiter 
        <a class="block-title-item-link athena" [routerLink]="['/request-monitoring']" queryParamsHandling="merge" >
            <span class="text-min normal no-transform athena"> Voir toutes les demandes </span>
        </a>
        <span class="block-title-item-link athena" >
            <span class="text-giant normal light-grey no-transform athena"> | </span> 
        </span>
        <a class="block-title-item-link athena" [routerLink]="null" (click)="allTasksClick()" queryParamsHandling="merge">
            <span class="text-min normal no-transform athena">Voir toutes les tâches </span>
        </a>
    </h2>
    <section class="container-fluid">
        <header class="row" *ngxPermissionsOnly="['afficher_taches_autres']">
            <span class="col-md-3 col-lg-1 col-form-label grey"> Tâches </span>
                <select class="form-control athena col-md-6 col-lg-6" id="user" 
                  [(ngModel)]="connectedUserId" name="connectedUserId" (change)="changeUser()" >
                  <option *ngFor="let user of usersList" [ngValue]="user.id">
                    {{ user?.lastName | uppercase}}  {{user?.firstName | firstName}} 
                  </option>
               </select>
        </header>
    </section> 
</div>
<div *ngIf="loading" class="wrapper">
    <div class="spinner">
    </div>
</div>
<div class="col-md-24 col-lg-24">
    <div class="block block-shadow">
                <h2 class="block-title athena" >{{title}}</h2>
                <section class="container-fluid">
                    <article class="row">
                        <div class="col-md-8 col-lg-8 mt-3">
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Responsable d'affaire</label>
                                <div class="col-md-16">
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearResponsableAffaireList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoA"
                                            [formControl]="responsableAffaireControl">
                                          <mat-autocomplete #autoA="matAutocomplete" [displayWith]="displayResponsableAffaire">
                                            <mat-option *ngFor="let responsableAffaire of filteredResponsableAffaire | async" [value]="responsableAffaire">
                                                {{ responsableAffaire?.lastName | uppercase}} {{responsableAffaire?.firstName | firstName}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Membre</label> 
                                 <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearMemberList()" >
                                        <input type="text"  matInput [matAutocomplete]="autoMembre" [formControl]="membreControl">
                                        <mat-autocomplete #autoMembre="matAutocomplete" [displayWith]="displayClient" > 
                                            <ng-template ngFor let-item [ngForOf]="filteredMembre$ | async">
                                                <mat-option [value]="item" >
                                                    <ul class="mat-summary">
                                                        <li> {{item?.name}} </li>
                                                        <li class="grey">{{ afficherNumContrat(item?.nicheIdentifier)}}</li>
                                                        <li class="grey">{{item?.status}}</li>
                                                    </ul>
                                                </mat-option>
                                                <mat-divider></mat-divider>
                                            </ng-template>
                                            
                                        </mat-autocomplete>
                                    </mat-form-field>
                                </div> 
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Parcours</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearParcoursList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoC"
                                            [formControl]="parcoursControl">
                                          <mat-autocomplete #autoC="matAutocomplete" [displayWith]="displayParcours">
                                            <mat-option *ngFor="let parcours of filteredParcours | async" [value]="parcours">
                                                {{parcours?.label}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Suivie par</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearSuiviParList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoD"
                                            [formControl]="suiviParControl">
                                          <mat-autocomplete #autoD="matAutocomplete" [displayWith]="displaySuiviPar">
                                            <mat-option *ngFor="let suiviPar of filteredSuiviPar | async" [value]="suiviPar">
                                                {{ suiviPar?.lastName | uppercase}} {{suiviPar?.firstName | firstName}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 col-lg-8 mt-3">
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Tâche prioritaire</label> 
                                <div class="form-check">
                                    <mat-checkbox  id="priority" [formControl]="priorityControl" [checked]="false"></mat-checkbox>
                                </div>
                            </div>
                                <label class="grey">Date de création</label>
                                <mat-form-field class="athena col-md-6 col-lg-6 ml-2" appearance="outline">
                                    <input matInput [matDatepicker]="pickerStart" placeholder=""
                                    name="dateDebut" [formControl]="dateDebutControl" (dateChange)="onSelectStartDate($event)" readonly>
                                    <mat-datepicker #pickerStart></mat-datepicker>
                                </mat-form-field>  
                                <span class="icon icon-marged calendar-grey clickable margin-top" (click)="pickerStart.open()" ></span>
                                <label  class="col-form-label marged-label mt-1 ml-2 mr-2"> à </label>
                                <mat-form-field class="athena col-md-6 col-lg-6" appearance="outline">
                                    <input matInput [matDatepicker]="pickerFinish" placeholder="" 
                                    name="dateFin" [formControl]="dateFinControl" [min]="rangeOfEndDate" (dateChange)="onSelectFinDate($event)" readonly>
                                    <mat-datepicker #pickerFinish></mat-datepicker>
                                </mat-form-field>  
                                <span class="icon icon-marged calendar-grey clickable margin-top" (click)="pickerFinish.open()" ></span><br/>
                            <div class="form-group row pt-4">
                                <label class="col-md-3 col-lg-6 col-form-label athena">N° de tâche</label> 
                                <div class="col-sm-6 mt-0">   
                                    <input class="form-control" type="text" [formControl]="numeroTache" (keypress)="filterInput($event)" pattern = "[0-9]{1,6}" normalize="{noLetters}" />
                                </div> 
                            </div>
                        </div>
                        <div class="col-md-8 col-lg-8 mt-3">
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Traité par</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearTraiteParList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoE"
                                            [formControl]="traiteParControl">
                                          <mat-autocomplete #autoE="matAutocomplete" [displayWith]="displayTraitePar">
                                            <mat-option *ngFor="let traitePar of filteredTraitePar | async" [value]="traitePar">
                                                {{ traitePar?.lastName | uppercase}}  {{traitePar?.firstName | firstName}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Statut de la tâche</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearStatutTacheList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoF"
                                            [formControl]="statutTacheControl">
                                          <mat-autocomplete #autoF="matAutocomplete" [displayWith]="displayStatutTache">
                                            <mat-option *ngFor="let statutTache of filteredStatutTache | async" [value]="statutTache">
                                                {{statutTache?.label}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>           
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Statut du panier</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearStatutPanierList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoG"
                                            [formControl]="statutPanierControl">
                                          <mat-autocomplete #autoG="matAutocomplete" [displayWith]="displayStatutPanier">
                                            <mat-option *ngFor="let stautPanier of filteredStatutPanier | async" [value]="stautPanier">
                                                <span [ngClass]="['icon', stautPanier.icone]" ></span>
                                                {{stautPanier?.label}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                    </article>
                    <div class="row">
                        <br/>
                    </div><br/>
                    <div class="link row" name="showField" ngDefaultControl [(ngModel)]="show" [hidden]="show === false">
                        <hr class="col-md-5 col-lg-5 mr-2">
                        <a class="athena col-md-4 col-lg-4 ml-3" (click)="onShow()">Voir la recherche avancée  
                            <span class="icon icon-min arrow-bottom-blue athena ml-1"></span>
                        </a>
                        <hr class="col-md-5 col-lg-5 ml-n1">
                    </div>
                    <div class="link row center" *ngIf="!show">
                        <hr class="col-md-5 col-lg-5 mr-2">
                        <a class=" athena col-md-4 col-lg-4" (click)="onHide()">Masquer la recherche avancée  
                            <span class="icon icon-min arrow-top-blue athena ml-1"></span>
                        </a>
                        <hr class="col-md-5 col-lg-5 ml-1">
                    </div><br/>
                    <div class="row">
                        <br/>
                    </div>
                    <article class="row" *ngIf="!show">
                        <div class="col-md-8 col-lg-8 mt-3">
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Rôle du créateur</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearRoleCreateurList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoH"
                                            [formControl]="roleCreateurControl"
                                            (change)="valueRolechange($event.target.value)">
                                          <mat-autocomplete #autoH="matAutocomplete" (optionSelected)="onSelectRole($event.option.value)" [displayWith]="displayRoleCreateur">
                                            <mat-option *ngFor="let roleCreateur of filteredRoleCreateur | async" [value]="roleCreateur">
                                                {{roleCreateur?.displayName}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Portefeuille</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearPortefeuilleList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoI"
                                            [formControl]="portefeuilleControl">
                                          <mat-autocomplete #autoI="matAutocomplete" [displayWith]="displayPortefeuille">
                                            <mat-option *ngFor="let portefeuille of filteredPortefeuille | async" [value]="portefeuille">
                                                {{ portefeuille?.lastName | uppercase}} {{portefeuille?.firstName | firstName}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 col-lg-8 mt-3">
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Créée par</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline">
                                        <mat-chip-list #chipCreateurList (click)="clearCreeeParList()">
                                            <mat-chip
                                            errorState="false"
                                            *ngFor="let createur of listCurrentCreateur"
                                            [selectable]="selectable"
                                            [removable]="removable"
                                            (removed)="removeCreateur(createur)">
                                                {{ createur?.lastName | uppercase}} {{createur?.firstName | firstName}}
                                            <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                                            </mat-chip>
                                            <input
                                            placeholder=""
                                            #JInputCreateur
                                            [formControl]="createurControl"
                                            [matAutocomplete]="autoJCreateur"
                                            [matChipInputFor]="chipCreateurList"
                                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                            >
                                        </mat-chip-list>
                                        <mat-autocomplete #autoJCreateur="matAutocomplete" (optionSelected)="selectedCreateur($event)">
                                            <mat-option *ngFor="let createur of filteredCreateur | async" [value]="createur">
                                                {{ createur?.lastName | uppercase}} {{createur?.firstName | firstName}}
                                            </mat-option>
                                        </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-3 col-lg-6 col-form-label athena">Pilotée par</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline" (click)="clearPiloteeParList()">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoK"
                                            [formControl]="piloterParControl">
                                          <mat-autocomplete #autoK="matAutocomplete"  [displayWith]="displayPilotee">
                                            <mat-option *ngFor="let pilotee of filteredPiloterPar | async" [value]="pilotee">
                                                {{pilotee?.firstName | firstName}} {{ pilotee?.lastName | uppercase}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 col-lg-8 mt-3">
                            <div class="form-group row">
                                <!-- <label class="col-md-3 col-lg-6 col-form-label athena">Backup</label> 
                                <div class="col-sm-16">   
                                    <mat-form-field class="large-chip-list" appearance="outline">
                                        <input type="text"
                                            matInput
                                            [matAutocomplete]="autoL"
                                            [formControl]="backUpControl">
                                          <mat-autocomplete #autoL="matAutocomplete" [displayWith]="displayBackup">
                                            <mat-option *ngFor="let backup of filteredBackUp | async" [value]="backup">
                                                {{backup}}
                                            </mat-option>
                                          </mat-autocomplete>
                                    </mat-form-field>
                                </div> -->
                            </div>
                        </div>
                    </article>
                    <div class="row offset-md-11 mt-2 control-buttons">
                        <input class="btn btn-green athena" type="submit" (click)="createServerSideDatasource()" value="Rechercher"/>
                    </div>
                    <section class="mt-5">
                        <div class="row"  *ngIf="!loadingRows && totalItems === 0">
                            <p class="center">Votre recherche ne donne aucun résultat, veuillez la modifier.</p>
                        </div>
                        <div [hidden]="totalItems === 0 || loadingRows"  > 
                            <app-athena-ag-grid2  id="taskTabId" 
                                [columnDefs]="columnDefs"
                                [rowStyle]="rowStyle"
                                [rowData]="rowData"
                                [datasource]="datasource"
                                [paginationPageSize]="paginationPageSize"
                                [masterDetail]="true"
                                [detailCellRendererParams]="detailCellRendererParams"
                                [detailRowHeight]="240"
                                [totalItems]="totalItems"
                                [loadAgGridParams]="params"
                                [showTopPagination]="true"
                                [suppressRowClickSelection]="true"
                                (sortChanged)="reloadGridAfterSortChanged($event)"
                                (clickCell)="clickCell($event)">
                            </app-athena-ag-grid2>
                        </div>
                        <app-athena-table-loader *ngIf="loadingRows"></app-athena-table-loader>

                    </section>
                </section> 
                <div  class="mt-4">
                    <h2 class="athena">
                        Légendes
                    </h2>
                    <div class="row">
                        <div class="col-md-4 col-sm-4 ml-3 mt-2">
                            <table aria-describedby="" class="table table-not-bordered">
                                <th id=""></th>
                                <p class="col-label grey"><u>Statut</u></p>
                                <tbody>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon picto-tache-annul"></span></td>
                                        <td>Tâche annulée</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon picto-tache-assign-dans-d-lais"></span></td>
                                        <td>Assignée dans délais</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon picto-tache-assign-hors-d-lais"></span></td>
                                        <td>Assignée hors délais</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon picto-tache-close-dans-d-lais"></span></td>
                                        <td>Cloturée dans délais</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon picto-tache-close-hors-d-lais"></span></td>
                                        <td>Cloturée hors délais</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="row">
                                <table aria-describedby="" class="table table-not-bordered">
                                    <th id=""></th>
                                    <tbody>
                                        <p class="col-md-8 col-lg-16 grey mt-5"><u>Couleurs des tâches</u></p>
                                        <tr class="mt-1">
                                            <td class="orange">Tâche : Tâche prioritaire</td>
                                        </tr>
                                        <tr class="mt-1">
                                            <td class="grey"><em>Tâche : Tâche clôturée ou annulée</em></td>
                                        </tr>
                                        <tr class="mt-1">
                                            <td class="black">Tâche : Tâche non prioritaire et ouverte</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-4 mt-2">  
                            <label class="col-md-8 col-lg-16 grey"><u>Pictos du tableau</u></label>        
                            <table aria-describedby="" class="table table-not-bordered mt-n2">
                                <th id=""></th>
                                <tbody>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon priority"></span></td>
                                        <td>Tâche prioritaire</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon icon parameters"></span></td>
                                        <td>Traiter la tâche</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon key athena"></span></td>
                                        <td>Clôturer la tâche</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon icon pen athena"></span></td>
                                        <td>Modifier la tâche</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon back-up"></span></td>
                                        <td>Tâche backup</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-15 col-lg-15 mt-2 pl-n10">
                            <table aria-describedby="" class="table table-not-bordered">
                                <th id=""></th>
                                <p class="col-label grey"><u>Panier</u></p>
                                <tbody>

                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-grey-normal"></span></td>
                                        <td>Le panier n'utilise pas d'envoi Publidispatch ou l'ordre a été annulée abandonnée ou pas encore créé</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-yellow-normal"></span></td>
                                        <td>La commande a été créée et elle n'est pas encore prise en compte par Publidispatch</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon panier-yellow-parnasse"></span></td>
                                        <td>La commande a été créée et elle n'est pas encore prise en compte par WinGSM</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-purple-normal"></span></td>
                                        <td>La commande a été prise par Publidispatch</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-purple-parnasse"></span></td>
                                        <td>La commande a été prise par WinGSM</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-orange-normal"></span></td>
                                        <td>La commande a été rejetée, ou partiellement expédiée mais des numéros de série n'ont pas été saisis ou ne sont pas gérés par Publidispatch</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-orange-parnasse"></span></td>
                                        <td>La commande a été rejetée, expédiée partiellement ou expédiée mais des numéros de série n'ont pas été saisis par WinGSM</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-green-normal"></span></td>
                                        <td>La commande est en cours de livraison ou a été expédiée avec tous les numéros de série saisis</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-green-parnasse"></span></td>
                                        <td>La commande utilise le stock Parnasse et le matériel a été mis à disposition par la logistique</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-blue-normal"></span></td>
                                        <td>La commande a été livrée au client</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-blue-parnasse"></span></td>
                                        <td>La commande utilise le stock Parnasse et elle a été livrée</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-red-normal"></span></td>
                                        <td>La commande a été retournée par le livreur</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-red-parnasse"></span></td>
                                        <td>La commande a été retournée par le livreur pour un stock différent de Publidispatch</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cart-grey-error"></span></td>
                                        <td>La commande est une erreur ou a été envoyée à Publidispatch il y a plus de 24h avec aucun retour de leur part</td>
                                    </tr>
                                    <tr>
                                        <td class="table-td-icon"><span class="icon cadenas-rouge"></span></td>
                                        <td>Panier contenant au moins un article bloqué</td>
                                    </tr>
                                </tbody>
                        </table>
                </div>

            </div>
        </div>
    </div>
</div>
<div *ngIf="loading" class="wrapper">
    <div class="spinner">
    </div>
</div>